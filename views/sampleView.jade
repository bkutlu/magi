extends layout
block body
	br
	div(class="container")
		-if (error)
			h3 Sample not found: #{sampleName}
		-else
			h3 #{sample.name} (#{cancer.cancer})
			br
			div(class="col-lg-8 col-md-8")
				h4 Mutations
				table(class="table", id="variant-table")
					thead
						tr(style="background:#d3d3d3")
							th Rank
							th Gene
							th Mutation class
							th Locus/Change
					tbody
						-for (var i = 0; i < mutations.length; i++)
							- var m  = mutations[i];
							- var geneBackground = m.geneReferences.length > 0 ? '#d9edf7' : '#ffffff'
							- var typeBackground = m.typeReferences && m.typeReferences.length > 0 ? '#d9edf7' : '#ffffff'
							- var locusBackground = m.locusReferences && m.locusReferences.length > 0 ? '#d9edf7' : '#ffffff'

							mixin refPopover(refs, title)
								- var rows = refs.map(function(d){ return '<tr><td><a href="http://www.ncbi.nlm.nih.gov/pubmed/' + d.pmid + '" target="_new">' + d.pmid + '</a></td><td>' + d.cancers.join(', ') + '</td></tr>' }).join("");
								- var tbl = '<table class="table" style="font-size:90%"><tr style="background:#d3d3d3"><th>Pubmed ID</th><th>Cancers</th></tr>' + rows + '</tr></table>'
								a(href='#', data-title='#{title}', data-trigger='focus', data-content='#{tbl}', data-toggle='popover', class='initialism badge')
									| #{refs.length}

							tr
								td(style="background:#ffffff") #{i+1}
								td(style="background:#{geneBackground}")
									| #{m.gene} &nbsp;
									-if (m.geneReferences.length > 0)
										+refPopover(m.geneReferences, m.gene + ' Variant Annotations')
								td(style="background:#{typeBackground}")
									| #{m.type} &nbsp;
									-if (m.typeReferences && m.typeReferences.length > 0)
										+refPopover(m.typeReferences, m.gene + ' ' + m.type + ' Annotations')
								td(style="background:#{locusBackground}")
									| #{m.change} &nbsp;
									-if (m.locusReferences && m.locusReferences.length > 0) 
										+refPopover(m.locusReferences, m.gene + ' ' + m.type + ' ' + m.change + ' Annotations')

			div(class="col-lg-4 col-md-4")
				h4 Sample annotations
				-if (!annotations || annotations.length == 0)
					b No sample annotation information available.
				-else
					table(class="table table-striped")
						thead
							tr(style="background:#d3d3d3")
								th Property
								th Value
						tbody
							-for (var i = 0; i < annotations.length; i++)
								tr
									td #{annotations[i].property}
									td #{annotations[i].value}

block belowTheFold
	script(src='/components/jquery/dist/jquery.min.js').
	script(src='/components/bootstrap/dist/js/bootstrap.min.js').
	script(src='/components/DataTables/media/js/jquery.dataTables.min.js').
	script(src='/js/dataTableWrapper.js').
	script(type='text/javascript').
		//- Convert the tables into DataTables
		addDataTable({ tableID: "#variant-table", aaSorting: [[0, "asc"]] });
		//- Set up the popovers
		$("[data-toggle=popover]").popover({html:true})