extends layout
block body
    br
    div(class="container", id="upload")
        div(class="row")
            h3 Upload your data.
        br
        div(class="row")
            p(class="bg-danger", style="padding:5px;font-size:110%")
                b
                    span(class="glyphicon glyphicon-warning-sign")
                    | &nbsp; Before you upload. 
                | By uploading data to MAGI, you agree to our 
                a(href="/terms") terms.
                | &nbsp; All data uploaded to MAGI is private to your account, 
                | and we will not share your data with anyone. 
                i Think before you upload. 
                | We encourage you to be vigilant to ensure you are not violating the
                | confidentiality of your patients. If you're uploading TCGA data, please 
                | consult the 
                a(href="https://wiki.nci.nih.gov/display/TCGAM/TCGA+Controlled-access+Data+Sharing+Policy", target="_new")
                    | TCGA controlled-data sharing policy
                | .
        div(class="row")
            h4 Step 0: Upload a manifest
            br
            p
                | You can simplify uploading data to MAGI by creating a 
                a(href="") JSON 
                | file to represent your data. Upload the JSON file below to populate the forms on this page
                | with your data. Then all you have to do is click &ldquo;Submit&rdquo; below!
            div
                span(class="btn btn-primary btn-file")
                    | Select manifest file 
                    input(class="btn form-control", type="file", id="manifestFileUpload")
                abbr(class="filename", style="margin-left:12px")
                div(id="manifestStatus", style="display:inline;margin-left:12px;")
        hr
        div(class="row")
            h4 Step 1: Pick a cancer, name, and color.
            br
        div(class="row")
            div(class="col-sm-3")
                label
                    | Cancer type (
                    a(href="/cancers") full list or add another
                    | )
                br
                select(class="form-control", id="cancer")
                    optgroup(label="TCGA & ICGC")
                    - for (var i in tcga_icgc_cancers)
                        option(value="#{tcga_icgc_cancers[i].abbr}") #{tcga_icgc_cancers[i].cancer} (#{tcga_icgc_cancers[i].abbr.toUpperCase()})
                    optgroup(label="User-defined")
                    - for (var i in user_cancers )
                        option(value="#{user_cancers[i].abbr}") #{user_cancers[i].cancer} (#{user_cancers[i].abbr.toUpperCase()})
            div(class="col-sm-3")
                label Dataset name (e.g. cancer type)
                input(type="text", id="dataset", name="dataset", class="form-control", placeholder="Enter dataset name.")
            div(class="col-sm-3 noselect")
                label
                | <strong>Color</strong> (hex;&nbsp;
                a(id="randomColor") initialize randomly
                | )
                div(style="margin-top:5px")
                    span(id="db-color", style="width:33px;height:33px;padding:2px;margin-right:5px;border:1px solid #eee;border-radius:8px;float:left")
                    input(type="text", id="color", name="color", class="form-control", placeholder="#XXXXXX", style="width:100px", maxlength="7")
            div(class="col-sm-3", id="groupNameContainer")
                label
                    | Group name (optional).
                input(type="text", id="groupName", name="groupName", class="form-control", placeholder="Enter group name (optional).")
        hr
        div(class="row")
            h4 Step 2: Select data to upload.
            br
            p
                | MAGI will allow you to upload whatever data you want, so long as your data adheres to one of our 
                a(href="#file-formats") supported file formats 
                | (see below). For example, both methylation and expression data can be uploaded as 
                em &ldquo;Other Aberrations&rdquo;
                | or as 
                em &ldquo;Data Matrices&rdquo;.
            br
        div(class="row")
            table(class="table")
                tr(style="background:#333;color:#fff")
                    th Data type and accepted formats
                    th File format
                    th File type
                    th File location
                    th Additional information (case-sensitive)
                tr
                    td
                        b Single nucleotide variants (SNVs)
                        ul
                            li
                                a(href="https://wiki.nci.nih.gov/display/TCGA/Mutation+Annotation+Format", target="_new")
                                    | TCGA Mutation Annotation Format (MAF)
                            li
                                a(href="#magi-format-snv") MAGI format (below)
                    td
                        select(id="SNVFileFormat", class="form-control")
                            option(value="MAGI") MAGI format
                            option(value="MAF") TCGA MAF format
                    td
                        select(id="SNVFileSource", class="form-control")
                            option(value="upload") Upload
                            option(value="url") URL
                    td
                        input(class="form-control", type="text", id="SNVFileURL", placeholder="Enter URL (including http://).", style="display:none")
                        span(class="btn btn-primary btn-file")
                            | Select file 
                            input(class="btn form-control", type="file", id="SNVFileUpload")
                        br
                        abbr(class="filename")
                    td N/A
                tr
                    td
                        b Copy number aberrations (CNAs)
                        ul
                            li
                                a(href="")
                                    | GISTIC2
                            li
                                a(href="#magi-format-cna") MAGI format (below)
                    td
                        select(id="CNAFileFormat", class="form-control")
                            option(value="MAGI") MAGI format
                            option(value="GISTIC2") GISTIC2 format (tar)
                    td
                        select(id="CNAFileSource", class="form-control")
                            option(value="upload") Upload
                            option(value="url") URL
                    td
                        input(class="form-control", type="text", id="CNAFileURL", placeholder="Enter URL (including http://).", style="display:none")
                        span(class="btn btn-primary btn-file")
                            | Select file 
                            input(class="btn form-control", type="file", id="CNAFileUpload")
                        br
                        abbr(class="filename")
                    td N/A
                tr
                    td
                        b Other aberrations
                        ul
                            li
                                a(href="#magi-format-other-aberrations") MAGI format (below)
                    td
                        a(href="#magi-format-other-aberrations") MAGI format
                    td
                        select(id="OtherAberrationsFileSource", class="form-control")
                            option(value="upload") Upload
                            option(value="url") URL
                    td
                        input(class="form-control", type="text", id="OtherAberrationsFileURL", placeholder="Enter URL (including http://).", style="display:none")
                        span(class="btn btn-primary btn-file")
                            | Select file 
                            input(class="btn form-control", type="file", id="OtherAberrationsFileUpload")
                        br
                        abbr(class="filename")
                    td
                        label Aberrations type (e.g. silenced).
                        input(class="form-control", id="OtherAberrationsType", value="Other")
                tr
                    td
                        b Data matrix (e.g. gene expression)
                        ul
                            li
                                a(href="#magi-format-data-matrix") MAGI format (below)
                    td
                        a(href="#magi-format-data-matrix") MAGI format
                    td
                        select(id="DataMatrixFileSource", class="form-control")
                            option(value="upload") Upload
                            option(value="url") URL
                    td
                        input(class="form-control", type="text", id="DataMatrixFileURL", placeholder="Enter URL (including http://).", style="display:none")
                        span(class="btn btn-primary btn-file")
                            | Select file 
                            input(class="btn form-control", type="file", id="DataMatrixFileUpload")
                        br
                        abbr(class="filename")
                    td
                        label Data type
                        br
                        select(class="form-control", style="display:inline", id="DataMatrixName", name="DataMatrixName")
                            option(value="Expression") Gene expression
                            option(value="Methylation") DNA methylation
                            option(value="Other") Other (please specify)
                        input(type="text", id="OtherDataMatrixName", class="form-control", placeholder="Data matrix type.", style="display:none;margin-top:5px")
                tr
                    td
                        b Sample annotations
                        ul
                            li
                                a(href="#magi-format-sample-annotations") MAGI format (below)
                    td
                        a(href="#magi-format-sample-annotations") MAGI format
                    td
                        select(id="SampleAnnotationsFileSource", class="form-control")
                            option(value="upload") Upload
                            option(value="url") URL
                    td
                        input(class="form-control", type="text", id="SampleAnnotationsFileURL", placeholder="Enter URL (including http://).", style="display:none")
                        span(class="btn btn-primary btn-file")
                            | Select file 
                            input(class="btn form-control", type="file", id="SampleAnnotationsFileUpload")
                        br
                        abbr(class="filename")
                    td N/A
                tr
                    td
                        b Annotation color file
                        ul
                            li
                                a(href="#magi-format-sample-annotations") MAGI format (below)
                    td
                        a(href="#magi-format-sample-annotations") MAGI format
                    td
                        select(id="AnnotationColorsFileSource", class="form-control")
                            option(value="upload") Upload
                            option(value="url") URL
                    td
                        input(class="form-control", type="text", id="AnnotationColorsFileURL", placeholder="Enter URL (including http://).", style="display:none")
                        span(class="btn btn-primary btn-file")
                            | Select file 
                            input(class="btn form-control", type="file", id="AnnotationColorsFileUpload")
                        br
                        abbr(class="filename")
                    td N/A

        div(class="row text-center")
            button(id="submit", type="button", class="btn btn-success") Submit
            div(id="status", style="display:inline;margin-left:15px")
        br
        div(class="row", id="output")
        hr
        a(name="file-formats")
        div(class="row")
            h3 MAGI file format specifications
        br
        a(name="magi-format-snv")
        div(class="row")
            h4 Single nucleotide variants
            p <strong>The SNV file is a tab-separated file (*.tsv)</strong> that includes all SNVs for a dataset.
                | Each row contains the data for a single SNV that occurs in one gene in one particular sample.
            p The columns whose names are starred are required.

            h5 Format example
            code PIK3CA&#9;TCGA-FD-A3B6&#9;ENST00000263967&#9;1068&#9;545&#9;Missense_Mutation&#9;E&#9;Q<br />
            code STAG1&#9;TCGA-B0-4700&#9;--&#9;--&#9;--&#9;--&#9;--&#9;--
            br
            br
            h5 Format description
            table(class="table table-bordered table-striped")
                tr
                    th Column
                    th Name (*=required)
                    th Example
                    th Description
                tr
                    td 1
                    td Gene*
                    td PIK3CA
                    td Gene name.
                tr
                    td 2
                    td Sample*
                    td TCGA-FD-A3B6
                    td Sample ID.
                tr
                    td 3
                    td Transcript
                    td ENST00000263967
                    td Transcript ID (RefSeq/ENSEMBL).
                tr
                    td 4
                    td Transcript Length
                    td 1068
                    td Length of transcript.
                tr
                    td 5
                    td Locus
                    td 545
                    td Position in transcript at which SNV occurred.
                tr
                    td 6
                    td Mutation Type
                    td Missense_Mutation
                    td
                        | Type of mutation that occurred. MAGI understands the following mutation types:
                        ul
                            li Nonsense_Mutation
                            li Frame_Shift_Del
                            li Frame_Shift_Ins
                            li Missense_Mutation
                            li Splice_Site
                            li In_Frame_Del
                            li In_Frame_Ins
                tr
                    td 7
                    td Original &nbsp;
                        abbr(title="Amino Acid") AA
                    td E
                    td The amino acid at the locus before the variant occurred.
                tr
                    td 8
                    td New &nbsp;
                        abbr(title="Amino Acid") AA
                    td Q
                    td The amino acid at the locus after the variant occurred.
        hr
        a(name="magi-format-cna")
        div(class="row")
            h4 Copy number variants
            p <strong>The CNA file is a tab-separated file (*.tsv)</strong> that includes all CNAs for a dataset.
                | Each row contains the data for a single copy number segment that occurs in one gene in one particular sample.
            p The columns whose names are starred are required.
            hr
            h5 Format example
            code PIK3CA&#9;TCGA-FD-A3B6&#9;AMP&#9;29843973&#9;30327089<br />
            code AKT1&#9;TCGA-06-0327 X&#9;--&#9;--&#9;--
            hr
            h5 Format description
            table(class="table table-bordered table-striped")
                tr
                    th Column
                    th Name (*=required)
                    th Example
                    th Description
                tr
                    td 1
                    td Gene*
                    td PIK3CA
                    td Gene name.
                tr
                    td 2
                    td Sample*
                    td TCGA-FD-A3B6
                    td Sample ID.
                tr
                    td 3
                    td CNA type
                    td 
                        | Type of CNA that occurred. MAGI understands the following CNA types:
                        ul
                            li AMP
                            li DEL

                    td Copy number type.
                tr
                    td 4
                    td Left
                    td 29843973
                    td Left start-point of segment.
                tr
                    td 5
                    td Right
                    td 30327089
                    td Right end-point of segment.

        hr
        a(name="magi-format-other-aberrations")
        div(class="row")
            h4 Other Aberrations
            p &ldquo;Other Aberrations&rdquo; can be any categorical, binary data. <strong>The &ldquo;Other
                | Aberrations&rdquo; file is a tab-separated file (*.tsv)</strong> that
                | contains an association list.
            p In each row the first column is a sample ID, and ensuing columns list genes that are aberrated.
            hr
            h5 Format example
            code TCGA-BL-A0C8&#9;A1BG&#9;A2M<br />
            hr
            h5 Format description
            br
            table(class="table table-bordered table-striped")
                tr
                    th Column
                    th Name (*=required)
                    th Example
                    th Description
                tr
                    td 1
                    td Sample ID*
                    td TCGA-FD-A3B6
                    td Sample ID Name
                tr
                    td >1
                    td Gene Name*
                    td PIK3CA
                    td Aberrated genes

        hr
        a(name="magi-format-data-matrix")
        div(class="row")
            h4 Data Matrix
            p <strong>The Data Matrix file is a tab-separated file (*.tsv)</strong>, such as
                | <strong>Expression </strong> or <strong>Methylation</strong> data, that
                | contains a matrix.
            p The TSV header is formatted such that the first column is empty, and every
                | additional column gives a Sample ID.
            p The TSV body (i.e., matrix) is formatted such that each row's first column is
                | a gene, and every following entry in a row is a cell of the matrix that
                | refers to a sample/gene pair.
            p Please also specify a <b>data type</b> with your matrix, which will display whenever
                | whenever you view this data.
            hr
            h5 Format example
            code &nbsp;&#9;TCGA-BL-A0C8&#9;TCGA-BL-A13I<br />
            code A1BG&#9;-2.533269&#9;0.106731<br />
            code A2M 1.03    1.02
            hr
            h5 Format description
            br
            p Header (row 1)
            table(class="table table-bordered table-striped")
                tr
                    th Column
                    th Name (*=required)
                    th Example
                    th Description
                tr
                    td 1
                    td Nothing*
                    td N/A
                    td The first column should be empty
                tr
                    td >1
                    td Sample ID*
                    td TCGA-BL-A0C8-01A-11R-A10U-07
                    td Sample ID Name
            p Matrix (rows > 1)
            table(class="table table-bordered table-striped")
                tr
                    th Column
                    th Name (*=required)
                    th Example
                    th Description
                tr
                    td 1
                    td Gene*
                    td PIK3CA
                    td Gene name.
                tr
                    td >1
                    td Value*
                    td 0.106731
                    td A value that corresponds to a gene/sample pair
        hr
        a(name="magi-format-sample-annotations")
        div(class="row")
            h4 Sample Annotations
            br
            label Sample Annotations
            input(type="file", id="SampleAnnotations", name="SampleAnnotations")
            label Annotation Color Mapping
            input(type="file", id="AnnotationColors", name="AnnotationColors")
            br
            p(class="single-dataset")
                | <strong>The Sample Annotations file is a tab-separated file (*.tsv)</strong>
                | lists the IDs of the samples in a dataset, as well as optional annotations.
                | Each row contains the data for a single sample. The first column lists the
                | sample ID, the second column lists the dataset (required when including more
                | than one column), and any remaining columns list additional annotations.
                | The first row <em>is a header</em>, with the names of each column. The names of
                | the annotation columns (3+) will be used as the name of the annotation
                | category (e.g. <code>expression subtype</code>).
                br
                br
                | We also support uploading an Annotation Colors file, which is a tab-separated
                | file where each row contains the color mapping for a different sample annotation.
                | The first column in the file is the category of the annotation (e.g.
                | <code>expression subtype</code>), the second column is the name of the annotation
                | (e.g. <code>Basal-like breast</code>), and the third column is a hex color.
            p(class="multi-dataset")
                | <strong>The Sample Annotations file is a tab-separated file (*.tsv)</strong>
                | lists the IDs of the samples in a dataset, as well as optional annotations.
                | Each row contains the data for a single sample. The first column lists the
                | sample ID, the second column lists the dataset (<b>required when uploading
                | multiple datasets</b>), and any remaining columns list additional annotations.
                | The first row <em>is a header</em>, with the names of each column. The names of
                | the annotation columns (3+) will be used as the name of the annotation
                | category (e.g. <code>expression subtype</code>).
                br
                br
                | We also support uploading an Annotation Colors file, which is a tab-separated
                | file where each row contains the color mapping for a different sample annotation.
                | The first column in the file is the category of the annotation (e.g.
                | <code>expression subtype</code>), the second column is the name of the annotation
                | (e.g. <code>Basal-like breast</code>), and the third column is a hex color.
            hr
            h5 Format example
            code Sample ID&#9;Dataset&#9;Expression subtype
            code TCGA-A7-A0CE&#9;BRCA&#9;Basal-like breast<br />
            code TCGA-43-6647&#9;LUSC&#9;Squamous
            hr
            h5 Format description
            table(class="table table-bordered table-striped")
                tr
                    th Column
                    th Name (*=required)
                    th Example
                    th Description
                tr
                    td 1
                    td Sample ID*
                    td TCGA-A7-A0CE
                    td Sample ID
                tr
                    td 2
                    td Dataset
                    td BRCA
                    td The dataset containing that sample
                tr
                    td 3+
                    td Annotation
                    td Basal-like breast
                    td Annotation for the sample (categorical or numeric)
block belowTheFold
    script(src='components/jquery/dist/jquery.min.js').
    script(src='components/jquery-form/jquery.form.js')
    script(src="js/dataset-upload-control.js")
    script.
        //- Make a map of cancer abbreviations to colors
        var user_cancers = !{JSON.stringify(user_cancers)},
            tcga_icgc_cancers = !{JSON.stringify(tcga_icgc_cancers)};
        //- user_cancers.forEach(function(c){ cancerToColor[c.abbr] = c.color; });
        //- tcga_icgc_cancers.forEach(function(c){ cancerToColor[c.abbr] = c.color; });
        //- //- Set the color chooser to the given color
        //- function setColor(color){
        //-     $('#db-color').css('background', color)
        //-     $("input#color").val(color);
        //-     $('span.uploadSummaryDatasetColor').css('background', color);
        //-     $('p.uploadSummaryDatasetColorHex').text(color);
        //- }
        //- //- Give the user a random color
        //- function randomColor(){
        //-     setColor('#' + Math.random().toString(16).substr(-6));
        //- }
        //- //- Update the color as the user changes the color input
        //- $("input#color").on("change", function(){
        //-     $("span#db-color").css('background', $("input#color").val());
        //- });
        //- //- Update the color chooser when the user changes the cancer type
        //- $("select#cancer").on("change", function(){
        //-     setColor(cancerToColor[$("select#cancer").val()]);
        //- });
        //- //- Initialize color with the first cancer
        //- setColor(cancerToColor[$("select#cancer").val()]);
        //- //- Show/hide fields based on whether the user is trying to
        //- //- upload one or more datasets
        //- $("input#multi-dataset").click(function(){
        //-     if ($("input#multi-dataset").is(':checked')){
        //-         $(".multi-dataset").show();
        //-         $(".single-dataset").hide();
        //-         $("input#dataset").attr("disabled", true);
        //-         $("input#color").attr("disabled", true);
        //-         $("div#groupNameContainer label").text("Group name");
        //-         $("div#groupNameContainer input").attr("placeholder", "Enter group name.");
        //-     }
        //-     else{
        //-         $(".single-dataset").show();
        //-         $(".multi-dataset").hide();
        //-         $("input#dataset").attr("disabled", false);
        //-         $("input#color").attr("disabled", false);
        //-         $("div#groupNameContainer label").text("Group name (optional)");
        //-         $("div#groupNameContainer input").attr("placeholder", "Enter group name (optional).");
        //-     }
        //- });